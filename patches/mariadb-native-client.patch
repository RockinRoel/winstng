diff --git a/CMakeLists.txt b/CMakeLists.txt
index c3bba33..9c1a4f6 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -102,31 +102,32 @@ IF(WIN32)
   INCLUDE(${CC_SOURCE_DIR}/cmake/version_info.cmake)
 ENDIF()
 
-IF(NOT IS_SUBPROJECT)
-IF(MSVC)
-  # Speedup system tests
-  INCLUDE(${CC_SOURCE_DIR}/cmake/WindowsCache.cmake)
-  IF (MSVC)
-    SET(CONFIG_TYPES "DEBUG" "RELEASE" "RELWITHDEBINFO")
-    FOREACH(BUILD_TYPE ${CONFIG_TYPES})
-      FOREACH(COMPILER CXX C)
-        SET(COMPILER_FLAGS "${CMAKE_${COMPILER}_FLAGS_${BUILD_TYPE}}")
-        IF (NOT COMPILER_FLAGS STREQUAL "")
-          STRING(REPLACE "/MD" "/MT" COMPILER_FLAGS ${COMPILER_FLAGS})
-          IF (CMAKE_BUILD_TYPE STREQUAL "Debug")
-            SET(COMPILER_FLAGS "${COMPILER_FLAGS} ${RTC_OPTIONS}")
-            STRING(REPLACE "/Zi" "/ZI" COMPILER_FLAGS ${COMPILER_FLAGS})
-          ELSE()
-            STRING(REPLACE "/Zi" "/Z7" COMPILER_FLAGS ${COMPILER_FLAGS})
-          ENDIF()
-          MESSAGE (STATUS "CMAKE_${COMPILER}_FLAGS_${BUILD_TYPE}= ${COMPILER_FLAGS}")
-          SET(CMAKE_${COMPILER}_FLAGS_${BUILD_TYPE} ${COMPILER_FLAGS})
-        ENDIF()
-      ENDFOREACH()
-    ENDFOREACH()
-  ENDIF()
-ENDIF()
-ENDIF(NOT IS_SUBPROJECT)
+SET(DEBUG_LIB_POSTFIX "d" CACHE STRING "String appended to debug libraries")
+#IF(NOT IS_SUBPROJECT)
+#IF(MSVC)
+#  # Speedup system tests
+#  INCLUDE(${CC_SOURCE_DIR}/cmake/WindowsCache.cmake)
+#  IF (MSVC)
+#    SET(CONFIG_TYPES "DEBUG" "RELEASE" "RELWITHDEBINFO")
+#    FOREACH(BUILD_TYPE ${CONFIG_TYPES})
+#      FOREACH(COMPILER CXX C)
+#        SET(COMPILER_FLAGS "${CMAKE_${COMPILER}_FLAGS_${BUILD_TYPE}}")
+#        IF (NOT COMPILER_FLAGS STREQUAL "")
+#          STRING(REPLACE "/MD" "/MT" COMPILER_FLAGS ${COMPILER_FLAGS})
+#          IF (CMAKE_BUILD_TYPE STREQUAL "Debug")
+#            SET(COMPILER_FLAGS "${COMPILER_FLAGS} ${RTC_OPTIONS}")
+#            STRING(REPLACE "/Zi" "/ZI" COMPILER_FLAGS ${COMPILER_FLAGS})
+#          ELSE()
+#            STRING(REPLACE "/Zi" "/Z7" COMPILER_FLAGS ${COMPILER_FLAGS})
+#          ENDIF()
+#          MESSAGE (STATUS "CMAKE_${COMPILER}_FLAGS_${BUILD_TYPE}= ${COMPILER_FLAGS}")
+#          SET(CMAKE_${COMPILER}_FLAGS_${BUILD_TYPE} ${COMPILER_FLAGS})
+#        ENDIF()
+#      ENDFOREACH()
+#    ENDFOREACH()
+#  ENDIF()
+#ENDIF()
+#ENDIF(NOT IS_SUBPROJECT)
 
 # Disable dbug information for release builds
 SET(CMAKE_C_FLAGS_RELEASE "${CMAKE_C_FLAGS_RELEASE} -DDBUG_OFF")
@@ -242,6 +243,7 @@ IF(WIN32)
   SET(HAVE_THREADS 1)
   ADD_DEFINITIONS(-DHAVE_DLOPEN)
   ADD_DEFINITIONS(-D_CRT_SECURE_NO_WARNINGS)
+  ADD_DEFINITIONS(-D_WIN32_WINNT=0x0600)
   IF(MSVC)
      SET(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} /wd4996" )
   ENDIF()
diff --git a/cmake/CheckFunctions.cmake b/cmake/CheckFunctions.cmake
index 58a6db3..9aa3a13 100644
--- a/cmake/CheckFunctions.cmake
+++ b/cmake/CheckFunctions.cmake
@@ -11,6 +11,8 @@
 # You will find the appropriate defines in 
 # include/my_config.h.in
 
+SET(CMAKE_REQUIRED_INCLUDES "stdlib.h")
+
 INCLUDE(CheckFunctionExists)
 
 CHECK_FUNCTION_EXISTS (access HAVE_ACCESS)
diff --git a/cmake/version_info.cmake b/cmake/version_info.cmake
index 4b2324a..19c66ac 100644
--- a/cmake/version_info.cmake
+++ b/cmake/version_info.cmake
@@ -9,14 +9,14 @@ FUNCTION(GET_FILE_VERSION FILE_NAME FILE_VERSION)
 
   # if we build from a git repository, we calculate the file version:
   #  Patch number is numer of commits for given file
-  IF(EXISTS ${CC_SOURCE_DIR}/.git)
-    EXECUTE_PROCESS(COMMAND git --git-dir=${CC_SOURCE_DIR}/.git --work-tree=${CC_SOURCE_DIR} rev-list HEAD --count -- ${FILE_NAME} 
-      OUTPUT_VARIABLE FV)
-    STRING(REPLACE "\n" "" FV ${FV})
-    SET(${FILE_VERSION} ${FV} PARENT_SCOPE)
-  ELSE()
+  #IF(EXISTS ${CC_SOURCE_DIR}/.git)
+  #  EXECUTE_PROCESS(COMMAND git --git-dir=${CC_SOURCE_DIR}/.git --work-tree=${CC_SOURCE_DIR} rev-list HEAD --count -- ${FILE_NAME} 
+  #    OUTPUT_VARIABLE FV)
+  #  STRING(REPLACE "\n" "" FV ${FV})
+  #  SET(${FILE_VERSION} ${FV} PARENT_SCOPE)
+  #ELSE()
     SET(${FILE_VERSION} 0)
-  ENDIF()
+  #ENDIF()
 ENDFUNCTION()
 
 MACRO(SET_VERSION_INFO)
diff --git a/include/ma_pthread.h b/include/ma_pthread.h
index 0273a6b..b2132d0 100644
--- a/include/ma_pthread.h
+++ b/include/ma_pthread.h
@@ -28,6 +28,8 @@
 #define ETIME ETIMEDOUT				/* For FreeBSD */
 #endif
 
+#define _TIMESPEC_DEFINED
+
 #ifdef  __cplusplus
 extern "C" {
 #endif /* __cplusplus */ 
diff --git a/libmariadb/CMakeLists.txt b/libmariadb/CMakeLists.txt
index 430020b..4503579 100644
--- a/libmariadb/CMakeLists.txt
+++ b/libmariadb/CMakeLists.txt
@@ -413,7 +413,10 @@ ENDIF()
 SET_TARGET_PROPERTIES(mariadbclient PROPERTIES IMPORTED_INTERFACE_LINK_LIBRARIES "${SYSTEM_LIBS}")
 SET_TARGET_PROPERTIES(libmariadb PROPERTIES IMPORTED_INTERFACE_LINK_LIBRARIES "${SYSTEM_LIBS}")
 
-SET_TARGET_PROPERTIES(libmariadb PROPERTIES PREFIX "")
+SET_TARGET_PROPERTIES(libmariadb PROPERTIES
+  PREFIX ""
+  DEBUG_POSTFIX ${DEBUG_LIB_POSTFIX}
+)
 
 #
 # Installation
@@ -438,15 +441,19 @@ SET_TARGET_PROPERTIES(libmariadb PROPERTIES VERSION
 
 INSTALL(TARGETS mariadbclient
           COMPONENT Development
-          DESTINATION ${INSTALL_LIBDIR})
+          RUNTIME DESTINATION "bin"
+          LIBRARY DESTINATION "lib"
+          ARCHIVE DESTINATION "lib")
 INSTALL(TARGETS libmariadb
           COMPONENT SharedLibraries
-        DESTINATION ${INSTALL_LIBDIR})
+          RUNTIME DESTINATION "bin"
+          LIBRARY DESTINATION "lib"
+          ARCHIVE DESTINATION "lib")
 
-IF(WIN32)
+IF(WIN32 AND CMAKE_BUILD_TYPE STREQUAL "Debug")
    # On Windows, install PDB
    GET_TARGET_PROPERTY(location libmariadb LOCATION)
-   STRING(REPLACE ".dll" ".pdb" pdb_location ${location})
+   STRING(REPLACE ".dll" "d.pdb" pdb_location ${location})
    IF (NOT "${CMAKE_CFG_INTDIR}" STREQUAL ".")
      STRING(REPLACE "${CMAKE_CFG_INTDIR}" "\${CMAKE_INSTALL_CONFIG_NAME}"
       pdb_location ${pdb_location})
